/*|| Custom Development || Object : CQ_HOURLY_SALE || Ticket Id :  411821 || Developer : Dipankar ||*/
SELECT 
GINVIEW.FNC_UK() UK,
S.NAME SITE_NAME,
TO_CHAR(TRUNC(M.BILLDATE),'MON-YY') MONTH_NAME,
TRUNC(M.BILLDATE) BILL_DATE,
COUNT(M.CODE) TOTAL_NOB,
SUM(M.NETAMT) TOTAL_NETAMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '00:00::00' AND '07:59::59' THEN M.CODE ELSE NULL END) SLAB_12_08AM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '00:00::00' AND '07:59::59' THEN M.NETAMT ELSE 0 END) SLAB_12_08AM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '08:00::00' AND '09:59::59' THEN M.CODE ELSE NULL END) SLAB_08_10AM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '08:00::00' AND '09:59::59' THEN M.NETAMT ELSE 0 END) SLAB_08_10AM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '10:00::00' AND '11:59::59' THEN M.CODE ELSE NULL END) SLAB_10_12AM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '10:00::00' AND '11:59::59' THEN M.NETAMT ELSE 0 END) SLAB_10_12AM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '12:00::00' AND '13:59::59' THEN M.CODE ELSE NULL END) SLAB_12_02PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '12:00::00' AND '13:59::59' THEN M.NETAMT ELSE 0 END) SLAB_12_02PM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '14:00::00' AND '15:59::59' THEN M.CODE ELSE NULL END) SLAB_02_04PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '14:00::00' AND '15:59::59' THEN M.NETAMT ELSE 0 END) SLAB_02_04PM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '16:00::00' AND '17:59::59' THEN M.CODE ELSE NULL END) SLAB_04_06PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '16:00::00' AND '17:59::59' THEN M.NETAMT ELSE 0 END) SLAB_04_06PM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '18:00::00' AND '19:59::59' THEN M.CODE ELSE NULL END) SLAB_06_08PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '18:00::00' AND '19:59::59' THEN M.NETAMT ELSE 0 END) SLAB_06_08PM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '20:00::00' AND '21:59::59' THEN M.CODE ELSE NULL END) SLAB_08_10PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '20:00::00' AND '21:59::59' THEN M.NETAMT ELSE 0 END) SLAB_08_10PM_AMT,
COUNT(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '22:00::00' AND '23:59::59' THEN M.CODE ELSE NULL END) SLAB_10_12PM_NOB,
SUM(CASE WHEN TO_CHAR(M.BILLDATE,'HH24:MI::SS') BETWEEN '22:00::00' AND '23:59::59' THEN M.NETAMT ELSE 0 END) SLAB_10_12PM_AMT
FROM PSITE_POSBILL M INNER JOIN ADMSITE S ON M.ADMSITE_CODE = S.CODE
WHERE TRUNC(M.BILLDATE) BETWEEN TO_DATE ('@DTFR@', 'YYYY-MM-DD') AND TO_DATE ('@DTTO@', 'YYYY-MM-DD') 
GROUP BY S.NAME ,
TO_CHAR(TRUNC(M.BILLDATE),'MON-YY'),
TRUNC(M.BILLDATE)