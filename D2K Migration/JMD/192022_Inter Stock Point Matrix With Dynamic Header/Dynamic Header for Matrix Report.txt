/* Formatted on 29-07-2022 18:39:24 (QP5 v5.294) */
SELECT tab1.*,
       tab2.COL1,
       tab2.COL2,
       tab2.COL3,
       tab2.COL4,
       tab2.COL5,
       tab2.COL6,
       tab2.COL7,
       tab2.COL8,
       tab2.COL9,
       tab2.COL10,
	   ginview.fnc_uk uk
  FROM (  SELECT stfcode,
                 item_remarks,
                 stfrate,
                 item_name,
                 SUM (CASE WHEN seq = 1 THEN quantity ELSE 0 END) size1,
                 SUM (CASE WHEN seq = 2 THEN quantity ELSE 0 END) size2,
                 SUM (CASE WHEN seq = 3 THEN quantity ELSE 0 END) size3,
                 SUM (CASE WHEN seq = 4 THEN quantity ELSE 0 END) size4,
                 SUM (CASE WHEN seq = 5 THEN quantity ELSE 0 END) size5,
                 SUM (CASE WHEN seq = 6 THEN quantity ELSE 0 END) size6,
                 SUM (CASE WHEN seq = 7 THEN quantity ELSE 0 END) size7,
                 SUM (CASE WHEN seq = 8 THEN quantity ELSE 0 END) size8,
                 SUM (CASE WHEN seq = 9 THEN quantity ELSE 0 END) size9,
                 SUM (CASE WHEN seq = 10 THEN quantity ELSE 0 END) size10,
                 SUM (quantity)                                  quantity
            FROM (  SELECT stfcode,
                           item_remarks,
                           hsn_code   hsn,
                           stfrate,
                           CASE
                              WHEN DMC = 1
                              THEN
                                    category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 2
                              THEN
                                    category1
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 3
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 4
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 5
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category6
                              WHEN DMC = 6
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                           END
                              item_name,
                           CASE
                              WHEN DMC = 1 THEN TRIM (category1)
                              WHEN DMC = 2 THEN TRIM (category2)
                              WHEN DMC = 3 THEN TRIM (category3)
                              WHEN DMC = 4 THEN TRIM (category4)
                              WHEN DMC = 5 THEN TRIM (category5)
                              WHEN DMC = 6 THEN TRIM (category6)
                           END
                              item_size,
                           DENSE_RANK ()
                           OVER (
                              PARTITION BY stfcode
                              ORDER BY
                                 stfcode,
                                 CASE
                                    WHEN DMC = 1 THEN TRIM (category1)
                                    WHEN DMC = 2 THEN TRIM (category2)
                                    WHEN DMC = 3 THEN TRIM (category3)
                                    WHEN DMC = 4 THEN TRIM (category4)
                                    WHEN DMC = 5 THEN TRIM (category5)
                                    WHEN DMC = 6 THEN TRIM (category6)
                                 END)
                              seq,
                           SUM (quantity) quantity
                      FROM GINVIEW.LV_INTER_STK_TRANFER d,
                           (SELECT s.*, m.DEFAULT_MATRIX_CATEGORY DMC
                              FROM admsite s, MAIN.ADMCMPPROF m
                             WHERE s.CMPCODE = m.CMPCODE) s,
                           ginview.lv_item          i
                     WHERE d.ADMSITE_CODE = s.code AND d.icode = i.code
                  GROUP BY stfcode,
                           item_remarks,
                           hsn_code,
                           stfrate,
                           CASE
                              WHEN DMC = 1
                              THEN
                                    category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 2
                              THEN
                                    category1
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 3
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 4
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category5
                                 || ' '
                                 || category6
                              WHEN DMC = 5
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category6
                              WHEN DMC = 6
                              THEN
                                    category1
                                 || ' '
                                 || category2
                                 || ' '
                                 || category3
                                 || ' '
                                 || category4
                                 || ' '
                                 || category5
                           END,
                           CASE
                              WHEN DMC = 1 THEN TRIM (category1)
                              WHEN DMC = 2 THEN TRIM (category2)
                              WHEN DMC = 3 THEN TRIM (category3)
                              WHEN DMC = 4 THEN TRIM (category4)
                              WHEN DMC = 5 THEN TRIM (category5)
                              WHEN DMC = 6 THEN TRIM (category6)
                           END)
        GROUP BY stfcode,
                 item_remarks,
                 stfrate,
                 item_name) tab1,
       (  SELECT stfcode,
                 MAX (CASE WHEN seq = 1 THEN i_size ELSE NULL END) col1,
                 MAX (CASE WHEN seq = 2 THEN i_size ELSE NULL END) col2,
                 MAX (CASE WHEN seq = 3 THEN i_size ELSE NULL END) col3,
                 MAX (CASE WHEN seq = 4 THEN i_size ELSE NULL END) col4,
                 MAX (CASE WHEN seq = 5 THEN i_size ELSE NULL END) col5,
                 MAX (CASE WHEN seq = 6 THEN i_size ELSE NULL END) col6,
                 MAX (CASE WHEN seq = 7 THEN i_size ELSE NULL END) col7,
                 MAX (CASE WHEN seq = 8 THEN i_size ELSE NULL END) col8,
                 MAX (CASE WHEN seq = 9 THEN i_size ELSE NULL END) col9,
                 MAX (CASE WHEN seq = 10 THEN i_size ELSE NULL END) col10
            FROM (SELECT DISTINCT
                         stfcode,
                         CASE
                            WHEN DMC = 1 THEN TRIM (category1)
                            WHEN DMC = 2 THEN TRIM (category2)
                            WHEN DMC = 3 THEN TRIM (category3)
                            WHEN DMC = 4 THEN TRIM (category4)
                            WHEN DMC = 5 THEN TRIM (category5)
                            WHEN DMC = 6 THEN TRIM (category6)
                         END
                            i_size,
                         DENSE_RANK ()
                         OVER (
                            PARTITION BY stfcode
                            ORDER BY
                               CASE
                                  WHEN DMC = 1 THEN TRIM (category1)
                                  WHEN DMC = 2 THEN TRIM (category2)
                                  WHEN DMC = 3 THEN TRIM (category3)
                                  WHEN DMC = 4 THEN TRIM (category4)
                                  WHEN DMC = 5 THEN TRIM (category5)
                                  WHEN DMC = 6 THEN TRIM (category6)
                               END)
                            seq
                    FROM GINVIEW.LV_INTER_STK_TRANFER d,
                         ginview.lv_item            i,
                         (SELECT s.*, m.DEFAULT_MATRIX_CATEGORY DMC
                            FROM admsite s, MAIN.ADMCMPPROF m
                           WHERE s.CMPCODE = m.CMPCODE) s
                   WHERE d.icode = i.code AND d.ADMSITE_CODE = s.code)
        GROUP BY stfcode) tab2
 WHERE tab1.stfcode = tab2.stfcode