/* Formatted on 2021/06/14 14:17 (Formatter Plus v4.8.8) */
CREATE OR REPLACE VIEW ginview.cv_adjust
AS
   SELECT ginview.fnc_uk uk, a.*
     FROM (SELECT purinvmain.invcode entcode, grsamt, trade_discount,
                  grsamt + trade_discount taxable, tax_amt, post_vat,
                  (NVL (chgamt, 0) - (trade_discount + tax_amt + post_vat)
                  ) others_amt,
                  netamt, 'PIM' add_det_enttype
             FROM purinvmain,
                  (SELECT   invcode,
                            NVL (SUM (DECODE (glcode,
                                              46, chgamt,
                                              660, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) trade_discount,
                            NVL (SUM (DECODE (glcode,
                                              30, chgamt,
                                              144, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) tax_amt,
                            NVL (SUM (DECODE (glcode,
                                              659, chgamt,
                                              29, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) post_vat,
                            NVL (SUM (DECODE (glcode,
                                              62, chgamt,
                                              661, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) others_amt
                       FROM purinvchg
                   GROUP BY invcode) chg
            WHERE purinvmain.invcode = chg.invcode(+)
           UNION ALL
           SELECT pursrvmain.srvcode, grsamt, trade_discount,
                  grsamt + trade_discount taxable, tax_amt,
                    DECODE (NVL (finjrnmain.damount, 0),
                            0, NVL (finjrnmain.camount, 0),
                            NVL (finjrnmain.damount, 0)
                           )
                  + post_vat post_vat,
                  (NVL (chgamt, 0) - (trade_discount + tax_amt + post_vat)
                  ) others_amt,
                  netamt, 'PSM'
             FROM pursrvmain,
                  finjrnmain,
                  (SELECT   srvcode,
                            NVL (SUM (DECODE (glcode,
                                              46, chgamt,
                                              660, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) trade_discount,
                            NVL (SUM (DECODE (glcode,
                                              30, chgamt,
                                              144, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) tax_amt,
                            NVL (SUM (DECODE (glcode,
                                              659, chgamt,
                                              29, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) post_vat,
                            NVL (SUM (DECODE (glcode,
                                              62, chgamt,
                                              661, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) others_amt
                       FROM pursrvchg
                   GROUP BY srvcode) chg
            WHERE pursrvmain.srvcode = chg.srvcode(+)
                  AND pursrvmain.jrncode = finjrnmain.jrncode(+)
           UNION ALL
           SELECT purrtmain.rtcode, grsamt, trade_discount,
                  grsamt + trade_discount taxable, tax_amt, post_vat,
                  (NVL (chgamt, 0) - (trade_discount + tax_amt + post_vat)
                  ) others_amt,
                  netamt, 'PRM' pim
             FROM purrtmain,
                  (SELECT   rtcode,
                            NVL (SUM (DECODE (glcode,
                                              46, chgamt,
                                              660, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) trade_discount,
                            NVL (SUM (DECODE (glcode,
                                              30, chgamt,
                                              144, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) tax_amt,
                            NVL (SUM (DECODE (glcode,
                                              659, chgamt,
                                              29, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) post_vat,
                            NVL (SUM (DECODE (glcode,
                                              62, chgamt,
                                              661, chgamt,
                                              0
                                             )
                                     ),
                                 0
                                ) others_amt
                       FROM purrtchg
                   GROUP BY rtcode) chg
            WHERE purrtmain.rtcode = chg.rtcode(+)
           UNION ALL
           SELECT finjrnmain.jrncode, NVL (damount, 0) + NVL (camount, 0), 0,
                  0, 0, 0, 0, NVL (damount, 0) + NVL (camount, 0),
                  jrntype pim
             FROM finjrnmain) a