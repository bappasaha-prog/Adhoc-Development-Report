/* Formatted on 16-03-2021 16:47:04 (QP5 v5.294) */
CREATE OR REPLACE VIEW ginview.cv_dc_item_custom
AS
     SELECT GINVIEW.FNC_UK UK,
            dccode,
            section,
            Qty,
            WSP,
            MRP,
            RSP,
            WSP_Discount,
            MRP_Discount,
            RSP_DISCOUNT,
            WSP_NETAMT,
            MRP_NETAMT,
            RSP_NETAMT,
            wsp_netamt - SUM (WSP_DISCOUNT) OVER (PARTITION BY dccode)
               WSP_NETAmount,
            MRP_NETAMT - SUM (MRP_DISCOUNT) OVER (PARTITION BY dccode)
               MRP_NETAmount,
            RSP_NETAMT - SUM (RSP_DISCOUNT) OVER (PARTITION BY dccode)
               RSP_NETAmount
       FROM (  SELECT D.dccode,
                      D.section,
                      SUM (challan_quantity)   Qty,
                      SUM (wsp * challan_quantity) WSP,
                      SUM (MRP * challan_quantity) MRP,
                      SUM (RSP * challan_quantity) RSP,
                      SUM (wsp_amount - rateamt) WSP_Discount,
                      SUM (MRP_amount - rateamt) MRP_Discount,
                      SUM (RSP_amount - rateamt) RSP_DISCOUNT,
                      WSP_NETAMT,
                      MRP_NETAMT,
                      RSP_NETAMT
                 FROM (SELECT dccode,
                              icode,
                              section,
                              challan_quantity,
                              wsp,
                              MRP,
                              RSP,
                              (challan_quantity * wsp)          WSP_amount,
                              (challan_quantity * MRP)          MRP_amount,
                              (challan_quantity * RSP)          RSP_amount,
                              (challan_quantity * CHALLAN_NET_RATE) RATEAMT,
                              SUM (challan_quantity * wsp)
                                 OVER (PARTITION BY dccode)
                                 WSP_NETAMT,
                              SUM (challan_quantity * MRP)
                                 OVER (PARTITION BY dccode)
                                 MRP_NETAMT,
                              SUM (challan_quantity * RSP)
                                 OVER (PARTITION BY dccode)
                                 RSP_NETAMT
                         FROM ginview.lv_dc_item A, ginview.lv_item B
                        WHERE a.icode = b.code) D
             GROUP BY dccode,
                      section,
                      WSP_NETAMT,
                      MRP_NETAMT,
                      RSP_NETAMT
             ORDER BY dccode, section)
   GROUP BY dccode,
            section,
            Qty,
            WSP,
            MRP,
            RSP,
            WSP_Discount,
            MRP_Discount,
            RSP_DISCOUNT,
            WSP_NETAMT,
            MRP_NETAMT,
            RSP_NETAMT