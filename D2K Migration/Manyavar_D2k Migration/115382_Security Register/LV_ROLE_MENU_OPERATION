DROP VIEW GINVIEW.LV_ROLE_MENU_OPERATION;

/* Formatted on 15/05/2021 10:56:57 (QP5 v5.294) */
CREATE OR REPLACE FORCE VIEW GINVIEW.LV_ROLE_MENU_OPERATION
(
   SYS_SHORTCODE,
   UK,
   SYS_NAME,
   MENUTREE,
   GROUPNUM,
   ISLEAF,
   ROLE_ID,
   ROLE_NAME,
   ALLOWEDOPERATION,
   NOTALLOWEDOPERATION
)
   BEQUEATH DEFINER
AS
     SELECT sys_shortcode,
            sys_shortcode || ROLE.ID uk,
            sys_name,
            menutree,
            ginview.FNC_UK         GROUPNUM,
            isleaf,
            ROLE.ID                role_id,
            ROLE.NAME              role_name,
            CASE
               WHEN isleaf = 1
               THEN
                  ginview.fnc_AllowedOperation (
                     p1_sys_mdmenushortcode   => sys_shortcode,
                     p_role_id                => ROLE.ID)
               ELSE
                  NULL
            END
               AllowedOperation,
            CASE
               WHEN isleaf = 1
               THEN
                  ginview.fnc_NotAllowedOperation (
                     p1_sys_mdmenushortcode   => sys_shortcode,
                     p_role_id                => ROLE.ID)
               ELSE
                  NULL
            END
               NotAllowedOperation
       FROM (           SELECT sys_shortcode,
                               sys_name,
                               SUBSTR (
                                     LPAD (LPAD ('    ', 4 * (LEVEL - 4)) || '|____',
                                           4 * (LEVEL - 2))
                                  || sys_name,
                                  1,
                                  350)
                                  menutree,
                               CONNECT_BY_ISLEAF isleaf
                          FROM ginssot.dim$mdmenu
                    START WITH sys_mdmenuparentshortcode IS NULL
                    CONNECT BY PRIOR sys_shortcode = sys_mdmenuparentshortcode
             ORDER SIBLINGS BY sys_mdmenuparentshortcode, sys_displayorder) T0,
            ROLE
   ORDER BY GROUPNUM;
