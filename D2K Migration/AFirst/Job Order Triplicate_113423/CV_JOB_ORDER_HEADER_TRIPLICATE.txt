DROP VIEW GINVIEW.CV_JOB_ORDER_HEADER_TRIPLICATE;

/* Formatted on 20/02/2021 15:45:34 (QP5 v5.294) */
CREATE OR REPLACE FORCE VIEW GINVIEW.CV_JOB_ORDER_HEADER_TRIPLICATE
(
   UK,
   CODE,
   JOB_ORDER_NO,
   NUMBERING_SCHEME,
   JOB_ORDER_DATE,
   REFERENCE_NO,
   PCODE,
   JOBBER_NAME,
   PRCODE,
   PROCESS_NAME,
   JOB_ORDER_TYPE,
   REMARKS,
   ADMOU_CODE,
   IS_CLOSED,
   CREATED_ON,
   CREATED_BY,
   LAST_MODIFIED_ON,
   LAST_MODIFIED_BY,
   ADMSITE_CODE,
   OWNER_SITE,
   OWNER_SITE_SHORTNAME,
   JOBBER_LOCCODE,
   JOBBER_WIP_STOCKPOINT,
   REFERENCE_DATE,
   YCODE,
   YNAME,
   L1
)
   BEQUEATH DEFINER
AS
   SELECT M.CODE || '-' || level_copy.l1        UK,
          M.CODE                                CODE,
          M.JOBNO                               Job_Order_No,
          DOC.DOCNAME                           Numbering_Scheme,
          M.JOB_DATE                            Job_Order_Date,
          M.REF_NO                              Reference_No,
          M.PCODE                               PCODE,
          S.SLNAME                              Jobber_Name,
          M.PRCODE,
          DECODE (UPPER (SUBSTR (TRIM (SUBSTR (P.PRNAME, 3)), 1, 9)),
                  'STITCHING', 'STITCHING',
                  SUBSTR (P.PRNAME, INSTR (P.PRNAME, '-', 1) + 1))
             Process_Name,
          INITCAP (M.JOBTYPE)                   Job_Order_Type,
          M.REMARKS,
          M.ADMOU_CODE,
          INITCAP (M.IS_CLOSED)                 IS_CLOSED,
          M.TIME                                Created_On,
          C.FNAME || ' ' || '[' || C.ENO || ']' Created_By,
          M.LAST_ACCESS_TIME                    Last_Modified_On,
          CASE
             WHEN LAST_ACCESS_ECODE IS NOT NULL
             THEN
                L.FNAME || ' ' || '[' || L.ENO || ']'
             ELSE
                NULL
          END
             Last_Modified_BY,
          M.ADMSITE_CODE                        ADMSITE_CODE,
          ST.NAME                               Owner_Site,
          ST.SHRTNAME                           OWNER_SITE_SHORTNAME,
          M.JOBBER_LOCCODE                      JOBBER_LOCCODE,
          L.LOCNAME                             Jobber_WIP_Stockpoint,
          M.REF_DT                              Reference_Date,
          M.YCODE,
          Y.YNAME,
          level_copy.l1                         l1
     FROM GINSSOT.DIM$PRDJOBMAIN   M,
          GINSSOT.DIM$HRDEMP       C,
          GINSSOT.DIM$HRDEMP       L,
          GINSSOT.DIM$FINSL        S,
          GINSSOT.DIM$PRDPR        P,
          GINSSOT.DIM$ADMDOCSCHEME DOC,
          GINSSOT.DIM$ADMSITE      ST,
          GINSSOT.DIM$INVLOC       L,
          GINSSOT.DIM$ADMYEAR      Y,
          (    SELECT LEVEL l1
                 FROM DUAL
           CONNECT BY LEVEL <= 3) level_copy
    WHERE     M.ECODE = C.ECODE
          AND M.LAST_ACCESS_ECODE = L.ECODE(+)
          AND M.PCODE = S.SLCODE
          AND M.PRCODE = P.PRCODE
          AND M.DOCCODE = DOC.DOCCODE(+)
          AND M.ADMSITE_CODE = ST.CODE
          AND M.JOBBER_LOCCODE = L.LOCCODE(+)
          AND M.YCODE = Y.YCODE;
