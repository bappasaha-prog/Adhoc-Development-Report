/* Formatted on 29/12/2021 17:37:11 (QP5 v5.294) */
DROP VIEW GINVIEW.CV_SALINV_ITEM_STATIC_MATRIX;


CREATE OR REPLACE FORCE VIEW GINVIEW.CV_SALINV_ITEM_STATIC_MATRIX
AS
     
     
     
     SELECT ginview.fnc_uk                                UK,
            a.invcode,
            M.LGTQTY,
            M.LGT_UNIT,
            section || ' - ' || department                item,
            HSN_CODE                                      HSN,
            RSP,
            invoice_rate                                  WSP,
            ROUND ( ( (RSP - invoice_rate) / RSP) * 100, 2) MR,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '26' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_26,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '28' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_28,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '30' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_30,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '32' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_32,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '34' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_34,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '36' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_36,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '38' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_38,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '39' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_39,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '40' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_40,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '42' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_42,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '44' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_44,
            SUM (
               CASE
                  WHEN TRIM (b.category3) = '46' THEN a.Invoice_Quantity
                  ELSE NULL
               END)
               SIZE_46,
            SUM (CASE
                    WHEN NVL (TRIM (b.category3), '99999') NOT IN ('26',
                                                                   '28',
                                                                   '30',
                                                                   '32',
                                                                   '34',
                                                                   '36',
                                                                   '38',
                                                                   '39',
                                                                   '40',
                                                                   '42',
                                                                   '44',
                                                                   '46')
                    THEN
                       A.Invoice_Quantity
                    ELSE
                       0
                 END)
               undiff,
            SUM (A.Invoice_Quantity)                      Invoice_Quantity
       FROM ginview.lv_salinv_item a,
            GINVIEW.LV_ITEM      b,
            (SELECT A.INVCODE                     UK,
                    A.INVCODE                     INVCODE,
                    A.INVDT                       INVOICE_DATE,
                    A.PCODE                       PCODE,
                    CUS.SLNAME                    CUSTOMER_NAME,
                    CUS.BEMAIL                    CUSTOMER_BILLING_EMAIL,
                    CUS.BEMAIL2                   CUSTOMER_BILLING_EMAIL2,
                    CUS.SEMAIL                    CUSTOMER_SHIPPING_EMAIL,
                    CUS.SEMAIL2                   CUSTOMER_SHIPPING_EMAIL2,
                    A.DOCNO                       DOCUMENT_NO,
                    A.DUEDT                       DUE_DATE,
                    A.AGCODE                      AGCODE,
                    NVL (AG.SLNAME, 'No Agent')   AGENT_NAME,
                    A.AGRATE                      AGENT_RATE,
                    A.GRSAMT                      GROSS_AMOUNT,
                    A.CHGAMT                      CHARGE_AMOUNT,
                    A.NETAMT                      NET_AMOUNT,
                    TAX.TAX_CHARGE_AMOUNT,
                    TAX.OTHER_CHARGE_AMOUNT,
                    A.ADJAMT                      ADJUSTMENT_AMOUNT,
                    G.GLNAME                      SALES_LEDGER,
                    A.REM                         REMARKS,
                    Y.YNAME                       YEAR_NAME,
                    C.FNAME || ' [' || C.ENO || ']' CREATED_BY,
                    A.TIME                        CREATED_ON,
                    T.SALTERMNAME                 SALES_TERM,
                    A.LAST_ACCESS_TIME            LAST_ACCESSED_ON,
                    M.FNAME || ' [' || M.ENO || ']' LAST_ACCESSED_BY,
                    L.LGTNO                       LOGISTIC_NO,
                    L.LGTDT                       LOGISTIC_DATE,
                    TR.SLNAME                     LOGISTIC_TRANSPORTER,
                    L.DOCNO                       LOGISTIC_DOCUMENT_NO,
                    L.DOCDT                       LOGISTIC_DOCUMENT_DATE,
                    L.STFR                        LOGISTIC_STATION_FROM,
                    L.STTO                        LOGISTIC_STATION_TO,
                    L.DECAMT                      LOGISTIC_DECLARED_AMOUNT,
                    L.QTY1                        LGTQTY,
                    L.UNIT1                       LGT_UNIT,
                    A.DOCDT                       DOCUMENT_DATE,
                    D.DOCNAME                     NUMBERING_SCHEME,
                    A.SCHEME_DOCNO                INVOICE_NO,
                    A.TRPCODE                     TRPCODE,
                    TRP.SLNAME                    TRANSPORTER_NAME,
                    G1.GLNAME                     ARAP_LEDGER,
                    S.SLNAME                      SALES_SUB_LEDGER,
                    A.TRANSITDAYS                 TRANSIT_DAYS,
                    INITCAP (A.ISSECONDARY)       SECONDARY_STOCK,
                    A.ADMOU_CODE,
                    A.ADMSITE_CODE                ADMSITE_CODE,
                    ST.SHRTNAME                   REFERENCE_SITE,
                    U.FNAME || ' [' || U.ENO || ']' AUTHORIZED_BY,
                    A.AUTHORIZE_TIME              AUTHORIZED_ON,
                    A.TRANSIT_DUE_DATE            TRANSIT_DUE_DATE,
                    A.DATASENDON                  DATA_SYNCED_ON,
                    A.ADMSITE_CODE_OWNER          ADMSITE_CODE_OWNER,
                    OS.SHRTNAME                   OWNER_SITE,
                    INITCAP (A.FORMAPP)           FORM_APPLICABLE,
                    A.FORMNO                      FORM_NO,
                    A.FORMDT                      FORM_DATE,
                    A.UDFSTRING01                 SALINMAIN_UDFSTRING01,
                    A.UDFSTRING02                 SALINMAIN_UDFSTRING02,
                    A.UDFSTRING03                 SALINMAIN_UDFSTRING03,
                    A.UDFSTRING04                 SALINMAIN_UDFSTRING04,
                    A.UDFSTRING05                 SALINMAIN_UDFSTRING05,
                    A.UDFSTRING06                 SALINMAIN_UDFSTRING06,
                    A.UDFSTRING07                 SALINMAIN_UDFSTRING07,
                    A.UDFSTRING08                 SALINMAIN_UDFSTRING08,
                    A.UDFSTRING09                 SALINMAIN_UDFSTRING09,
                    A.UDFSTRING10                 SALINMAIN_UDFSTRING10,
                    A.UDFNUM01                    SALINVMAIN_UDFNUM01,
                    A.UDFNUM02                    SALINVMAIN_UDFNUM02,
                    A.UDFNUM03                    SALINVMAIN_UDFNUM03,
                    A.UDFNUM04                    SALINVMAIN_UDFNUM04,
                    A.UDFNUM05                    SALINVMAIN_UDFNUM05,
                    A.UDFDATE01                   SALINVMAIN_UDFDATE01,
                    A.UDFDATE02                   SALINVMAIN_UDFDATE02,
                    A.UDFDATE03                   SALINVMAIN_UDFDATE03,
                    A.UDFDATE04                   SALINVMAIN_UDFDATE04,
                    A.UDFDATE05                   SALINVMAIN_UDFDATE05,
                    INITCAP (A.RELEASE_STATUS)    RELEASE_STATUS,
                    A.RELEASE_TIME                RELEASE_ON,
                    R.FNAME || ' [' || R.ENO || ']' RELEASE_BY,
                    P.NAME                        TRADE_GROUP_NAME,
                    F.FORMNAME                    FORM_NAME,
                    A.FORMAMT                     FORM_AMOUNT,
                    PL.PRICELISTNAME              PRICE_LIST_NAME,
                    A.DISCOUNT_FACTOR             DISCOUNT_FACTOR,
                    A.PRICE_ROUNDOFF              PRICE_ROUND_OFF,
                    INITCAP (A.ROUNDOFF_LIMIT)    PRICE_ROUNF_OFF_LIMIT,
                    INITCAP (A.INCL_VAT_IN_DIST)  PRICE_INCLUSION_OF_TAX,
                    INITCAP (A.DISCOUNT_MODE)     PRICE_MODE,
                    INITCAP (A.DISCOUNT_BASIS)    PRICE_BASIS,
                    I.INTGNAME                    THIRD_PARTY_SOURCE,
                    A.OWNER_GSTIN_NO              OWNER_GSTIN_NO,
                    A.OWNER_GSTIN_STATE_CODE      OWNER_GSTIN_STATE_CODE,
                    GST.NAME                      OWNER_GSTIN_STATE_NAME,
                    A.CP_GSTIN_NO                 CP_GSTIN_NO,
                    A.CP_GSTIN_STATE_CODE         CP_GSTIN_STATE_CODE,
                    CPGST.NAME                    CP_GSTIN_STATE_NAME,
                    A.GSTAPPL                     Is_GST_Applicable,
                    A.EWAYBILLNO                  E_way_Bill_No,
                    A.EWAYBILLGENERATEDON         E_way_Bill_Generated_On,
                    A.EWAYBILLVALIDUPTO           E_way_Bill_Valid_Upto,
                    A.GLCODE                      GLCODE,
                    EI.E_INVOICE_IRN,
                    EI.E_INVOICE_ACK_DATETIME,
                    EI.E_INVOICE_ACK_NO,
                    EI.E_INVOICE_SIGNED_QR_DATA,
                    EI.E_INVOICE_UPDATED_BY,
                    EI.E_INVOICE_UPDATED_ON
               FROM ginssot.FACT$SALINVMAIN    A,
                    ginssot.DIM$FINSL          CUS,
                    ginssot.DIM$FINSL          AG,
                    ginssot.DIM$FINSL          TRP,
                    ginssot.DIM$FINGL          G,
                    ginssot.DIM$ADMYEAR        Y,
                    ginssot.DIM$HRDEMP         C,
                    ginssot.DIM$SALTERMMAIN    T,
                    ginssot.DIM$HRDEMP         M,
                    ginssot.DIM$ADMDOCSCHEME   D,
                    ginssot.DIM$FINGL          G1,
                    ginssot.DIM$FINSL          S,
                    ginssot.DIM$HRDEMP         U,
                    ginssot.DIM$HRDEMP         R,
                    ginssot.DIM$FINTRADEGRP    P,
                    ginssot.DIM$FINFORM        F,
                    ginssot.DIM$INTGMAIN       I,
                    ginssot.DIM$ADMSITE        ST,
                    ginssot.DIM$ADMSITE        OS,
                    ginssot.DIM$SALPRICELISTMAIN PL,
                    ginssot.DIM$ADMGSTSTATE    GST,
                    ginssot.DIM$ADMGSTSTATE    CPGST,
                    ginssot.DIM$INVLGTNOTE     L,
                    ginssot.DIM$FINSL          TR,
                    (SELECT A.TRANSACTION_CODE,
                            A.IRN          E_INVOICE_IRN,
                            A.ACK_DATETIME E_INVOICE_ACK_DATETIME,
                            A.ACK_NO       E_INVOICE_ACK_NO,
                            A.SIGNED_QR_DATA E_INVOICE_SIGNED_QR_DATA,
                            E.FNAME || ' [' || E.ENO || ']'
                               E_INVOICE_UPDATED_BY,
                            A.UPDATED_ON   E_INVOICE_UPDATED_ON
                       FROM INVGST_EINVOICE A, HRDEMP E
                      WHERE     A.UPDATED_BY = E.ECODE(+)
                            AND A.TRANSACTION_TABLE = 'SALINVMAIN') EI,
                    (  SELECT INVCODE,
                              SUM (
                                 CASE
                                    WHEN ISTAX = 'YES' THEN NVL (CHGAMT, 0)
                                    ELSE 0
                                 END)
                                 TAX_CHARGE_AMOUNT,
                              SUM (
                                 CASE
                                    WHEN ISTAX = 'NO' THEN NVL (CHGAMT, 0)
                                    ELSE 0
                                 END)
                                 OTHER_CHARGE_AMOUNT
                         FROM ginssot.FACT$SALINVCHG
                     GROUP BY INVCODE) TAX
              WHERE     A.GLCODE = G.GLCODE
                    AND A.PCODE = CUS.SLCODE(+)
                    AND A.AGCODE = AG.SLCODE(+)
                    AND A.TRPCODE = TRP.SLCODE(+)
                    AND A.YCODE = Y.YCODE
                    AND A.ECODE = C.ECODE
                    AND A.SALTERMCODE = T.SALTERMCODE(+)
                    AND A.LAST_ACCESS_ECODE = M.ECODE(+)
                    AND A.DOCCODE = D.DOCCODE(+)
                    AND A.PGLCODE = G1.GLCODE
                    AND A.SLCODE = S.SLCODE(+)
                    AND A.AUTHORIZE_ECODE = U.ECODE(+)
                    AND A.RELEASE_ECODE = R.ECODE(+)
                    AND A.SALTRADEGRP_CODE = P.CODE(+)
                    AND A.FORMCODE = F.FORMCODE(+)
                    AND A.INTGCODE = I.INTGCODE(+)
                    AND A.LGTCODE = L.LGTCODE(+)
                    AND L.TRPCODE = TR.SLCODE(+)
                    AND A.ADMSITE_CODE = ST.CODE(+)
                    AND A.ADMSITE_CODE_OWNER = OS.CODE
                    AND A.PRICELISTCODE = PL.PRICELISTCODE(+)
                    AND A.INVCODE = TAX.INVCODE(+)
                    AND A.SALETYPE = 'OUTRIGHT'
                    AND A.OWNER_GSTIN_STATE_CODE = GST.CODE(+)
                    AND A.CP_GSTIN_STATE_CODE = CPGST.CODE(+)
                    AND TO_CHAR (A.INVCODE) = EI.TRANSACTION_CODE(+)) M
      WHERE a.ICODE = b.code                        /*AND a.invcode = 815397*/
                            AND M.INVCODE = a.INVCODE
   GROUP BY a.invcode,
            M.LGTQTY,
            M.LGT_UNIT,
            section || ' - ' || department,
            HSN_CODE,
            RSP,
            invoice_rate;