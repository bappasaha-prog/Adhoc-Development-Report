/* Formatted on 20-04-2022 15:47:29 (QP5 v5.294) */
CREATE OR REPLACE FORCE VIEW GINVIEW.CV_AP_VOUCHER
AS
   SELECT D.CODE                              UK,
          M.VCHCODE,
          M.ADMSITE_CODE_OWNER,
          ST.SHRTNAME                         OWNER_SITE,
          M.VCHDT                             VOUCHER_DATE,
          CRE.FNAME || ' [' || CRE.ENO || ']' CREATED_BY,
          M.TIME                              CREATED_ON,
          M.GLCODE                            CB_GLCODE,
          G.GLNAME                            CASH_BANK_LEDGER,
          MDY.FNAME || ' [' || MDY.ENO || ']' LAST_ACCESSED_BY,
          M.LAST_ACCESS_TIME                  LAST_ACCESSED_ON,
          M.NARTEXT                           REMARKS,
          DOC.DOCNAME                         NUMBERING_SCHEME,
          M.SCHEME_DOCNO                      VOUCHER_NO,
          M.REFNO                             HEADER_REFERENCE,
          RLS.FNAME || ' [' || RLS.ENO || ']' RELEASED_BY,
          INITCAP (M.RELEASE_STATUS)          RELEASE_STATUS,
          M.ADMOU_CODE,
          OU.NAME                             OU_NAME,
          M.RELEASE_TIME                      RELEASED_ON,
          Y.YNAME                             YEAR_NAME,
          INITCAP (M.ISADVANCE)               ONACCOUNTPAYMENT,
          D.REFNO                             DETAIL_REFERENCE,
          D.GLCODE                            ARAP_GLCODE,
          GD.GLNAME                           ARAP_Ledger,
          D.SLCODE                            ARAP_SLCODE,
          S.SLNAME                            ARAP_Sub_Ledger,
          S.BEMAIL                            ARAP_SL_BILLING_EMAIL,
          S.BEMAIL2                           ARAP_SL_BILLING_EMAIL2,
          S.SEMAIL                            ARAP_SL_SHIPPING_EMAIL,
          S.SEMAIL2                           ARAP_SL_SHIPPING_EMAIL2,
          D.CHQNO                             INSTRUMENT_NO,
          D.CHQDT                             INSTRUMENT_DATE,
             SUBSTR (TO_CHAR (D.CHQDT, 'DD'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'DD'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'MM'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'MM'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 3, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 4, 1)
             DDMMYYYY,
          D.DRAWNON                           INSTRUMENT_DRAWN_ON,
          D.DAMOUNT                           AMOUNT,
          ginview.spell_money (D.DAMOUNT)     amount_in_words,
          D.BRSDT                             BRS_DATE,
          D.ADJAMT                            ADJUSTMENT_AMOUNT,
          D.CHQLABEL                          CHEQUE_LABEL,
          D.NARTEXT                           NARRATION,
          INITCAP (D.PAYMENT_MODE)            PAYMENT_MODE,
          D.REF_ADMSITE_CODE                  DETAIL_REF_ADMSITE_CODE,
          SD.SHRTNAME                         REFERENCE_SITE,
          INITCAP (D.ISREVERSAL)              ISREVERSAL,
          'VDP'                               ENTTYPE,
          D.TDS_RATE                          TDS_Rate,
          INITCAP (D.TDS_APP)                 TDS_Applicable,
          D.TDSSECTION                        TDS_Section,
          D.TDS_APPAMT                        TDS_APPLICABLE_Amount,
          D.TDSAMT                            TDS_AMOUNT,
          D.GRS_AMT                           Gross_Payable_Amount,
          CHQ.BOOKNO                          CHEQUE_BOOK_NO,
          CASE
             WHEN M.RELEASE_STATUS IN ('POSTED', 'UNPOSTED') THEN 'Yes'
             WHEN M.RELEASE_STATUS = 'POSTED' THEN 'No'
          END
             INCLUDEUNPOSTEDRECORDS
     FROM GINSSOT.FACT$FINVCHMAIN  M,
          GINSSOT.FACT$VOUCHER     D,
          GINSSOT.DIM$ADMSITE      ST,
          GINSSOT.DIM$HRDEMP       CRE,
          GINSSOT.DIM$FINGL        G,
          GINSSOT.DIM$FINGL        GD,
          GINSSOT.DIM$FINSL        S,
          GINSSOT.DIM$HRDEMP       MDY,
          GINSSOT.DIM$HRDEMP       RLS,
          GINSSOT.DIM$ADMYEAR      Y,
          GINSSOT.DIM$ADMDOCSCHEME DOC,
          GINSSOT.DIM$ADMSITE      SD,
          GINSSOT.DIM$FINCHQMAIN   CHQ,
          GINSSOT.DIM$ADMOU        OU
    WHERE     M.VCHCODE = D.VCHCODE
          AND M.ECODE = CRE.ECODE
          AND M.ADMSITE_CODE_OWNER = ST.CODE(+)
          AND M.GLCODE = G.GLCODE
          AND M.LAST_ACCESS_ECODE = MDY.ECODE(+)
          AND M.RELEASE_ECODE = RLS.ECODE(+)
          AND M.YCODE = Y.YCODE
          AND M.DOCCODE = DOC.DOCCODE
          AND D.GLCODE = GD.GLCODE
          AND D.SLCODE = S.SLCODE(+)
          AND D.REF_ADMSITE_CODE = SD.CODE(+)
          AND D.BOOKCODE = CHQ.BOOKCODE(+)
          AND M.ADMOU_CODE = OU.CODE(+)
          AND M.VCHTYPE IN ('PAYMENT', 'BOTH ARAP');