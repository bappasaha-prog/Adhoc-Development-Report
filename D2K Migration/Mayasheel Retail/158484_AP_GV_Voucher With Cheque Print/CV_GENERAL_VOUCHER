CREATE OR REPLACE FORCE VIEW GINVIEW.CV_GENERAL_VOUCHER
AS
   SELECT D.CODE                              UK,
          M.VCHCODE,
          M.ADMSITE_CODE_OWNER,
          ST.SHRTNAME                         OWNER_SITE,
          M.VCHDT                             VOUCHER_DATE,
          CRE.FNAME || ' [' || CRE.ENO || ']' CREATED_BY,
          M.TIME                              CREATED_ON,
          M.GLCODE                            CB_GLCODE,
          G.GLNAME                            Cash_Bank_Ledger,
          MDY.FNAME || ' [' || MDY.ENO || ']' LAST_ACCESSED_BY,
          M.LAST_ACCESS_TIME                  LAST_ACCESSED_ON,
          M.NARTEXT                           REMARKS,
          DOC.DOCNAME                         NUMBERING_SCHEME,
          M.SCHEME_DOCNO                      VOUCHER_NO,
          M.REFNO                             REFERENCE,
          RLS.FNAME || ' [' || RLS.ENO || ']' RELEASED_BY,
          INITCAP (M.RELEASE_STATUS)          RELEASE_STATUS,
          M.ADMOU_CODE,
          OU.NAME                             OU_NAME,
          M.RELEASE_TIME                      RELEASED_ON,
          Y.YNAME                             YEAR_NAME,
          D.GLCODE                            GL_GLCODE,
          GD.GLNAME                           GENERAL_LEDGER,
          D.SLCODE                            SL_SLCODE,
          SL.SLNAME                           Sub_Ledger,
          D.CHQNO                             INSTRUMENT_NO,
          D.CHQDT                             INSTRUMENT_DATE,
          D.DRAWNON                           INSTRUMENT_DRAWN_ON,
          D.DAMOUNT                           DEBIT,
          D.CAMOUNT                           CREDIT,
          D.BRSDT                             BRS_DATE,
          D.ADJAMT                            ADJUSTMENT_AMOUNT,
          D.CHQLABEL                          CHEQUE_LABEL,
          D.NARTEXT                           Narration,
          INITCAP (D.PAYMENT_MODE)            PAYMENT_MODE,
          INITCAP (D.ISREVERSAL)              ISREVERSAL,
          CHQ.BOOKNO                          CHEQUE_BOOK_NO,
          D.REF_ADMSITE_CODE                  REF_ADMSITE_CODE,
          RF.SHRTNAME                         REFERENCE_SITE,
          CASE
             WHEN M.RELEASE_STATUS IN ('POSTED', 'UNPOSTED') THEN 'Yes'
             WHEN M.RELEASE_STATUS = 'POSTED' THEN 'No'
          END
             INCLUDEUNPOSTEDRECORDS,
             SUBSTR (TO_CHAR (D.CHQDT, 'DD'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'DD'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'MM'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'MM'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 1, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 2, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 3, 1)
          || '   '
          || SUBSTR (TO_CHAR (D.CHQDT, 'YYYY'), 4, 1)
             DDMMYYYY,
          ABS (D.DAMOUNT - D.CAMOUNT)         Amount
     FROM GINSSOT.FACT$FINVCHMAIN  M,
          GINSSOT.FACT$VOUCHER     D,
          GINSSOT.DIM$ADMSITE      ST,
          GINSSOT.DIM$HRDEMP       CRE,
          GINSSOT.DIM$FINGL        G,
          GINSSOT.DIM$FINGL        GD,
          GINSSOT.DIM$FINSL        SL,
          GINSSOT.DIM$HRDEMP       MDY,
          GINSSOT.DIM$HRDEMP       RLS,
          GINSSOT.DIM$ADMYEAR      Y,
          GINSSOT.DIM$ADMDOCSCHEME DOC,
          GINSSOT.DIM$FINCHQMAIN   CHQ,
          GINSSOT.DIM$ADMSITE      RF,
          GINSSOT.DIM$ADMOU        OU
    WHERE     M.VCHCODE = D.VCHCODE
          AND M.ECODE = CRE.ECODE
          AND M.ADMSITE_CODE_OWNER = ST.CODE(+)
          AND M.GLCODE = G.GLCODE
          AND M.LAST_ACCESS_ECODE = MDY.ECODE(+)
          AND M.RELEASE_ECODE = RLS.ECODE(+)
          AND M.YCODE = Y.YCODE
          AND M.DOCCODE = DOC.DOCCODE
          AND D.GLCODE = GD.GLCODE
          AND D.BOOKCODE = CHQ.BOOKCODE(+)
          AND D.SLCODE = SL.SLCODE(+)
          AND D.REF_ADMSITE_CODE = RF.CODE(+)
          AND M.ADMOU_CODE = OU.CODE(+)
          AND M.VCHTYPE IN ('GENERAL');
